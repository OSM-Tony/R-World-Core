<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R-World Core â€” Command Line Interface Safe Mode with Database View Prep</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #f5f5f5; display: flex; flex-direction: column; height: 100vh; }
        #consoleOutput { flex: 1; font-size: 12px; background: #111; padding: 10px; overflow-y: auto; }
        .log-entry { margin-bottom: 4px; }
        .json-log { color: #0f0; }
        .system-log { color: #00bfff; }
        .error-log { color: #ff4444; }
        .hidden-log { display: none; }
        #buttonBar { background: #222; padding: 5px; display: flex; gap: 10px; justify-content: center; }
        #buttonBar button { border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; }
        .btn-on { background-color: #28a745; color: #fff; }
        .btn-off { background-color: #555; color: #aaa; }
        #commandLine { background: #333; padding: 5px; display: flex; }
        #commandLine input { flex: 1; padding: 8px; border: none; color: #fff; background: #444; }
        #commandLine button { padding: 8px; border: none; background: #555; color: #fff; cursor: pointer; }
    </style>
</head>
<body>
    <div id="consoleOutput"></div>
    <div id="buttonBar">
        <button id="jsonLogBtn" class="btn-on" onclick="toggleLog('json')">JSON</button>
        <button id="systemLogBtn" class="btn-on" onclick="toggleLog('system')">SYSTEM</button>
        <button id="errorLogBtn" class="btn-on" onclick="toggleLog('error')">ERROR</button>
        <button onclick="loadDatabaseView()">Database View</button>
    </div>
    <div id="commandLine">
        <input id="cmdInput" type="text" placeholder="Enter command here...">
        <button onclick="executeCommand()">Run</button>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyCImKSrWlWkHBPZe1-g--jcl_xthZyORhI",
            authDomain: "r-world-core.firebaseapp.com",
            databaseURL: "https://r-world-core-default-rtdb.firebaseio.com",
            projectId: "r-world-core",
            storageBucket: "r-world-core.firebasestorage.app",
            messagingSenderId: "335093562897",
            appId: "1:335093562897:web:f2be99bb04eb06d2123bb0",
            measurementId: "G-ZMXF2QEBXQ"
        };

        const logSettings = { json: true, system: true, error: true };

        firebase.initializeApp(firebaseConfig);

        firebase.auth().signInWithEmailAndPassword('rworlddev@gmail.com', 'vancouverhl119!')
            .then(() => addLog('Signed in successfully.', 'system'))
            .catch((error) => addLog('Authentication error: ' + error.message, 'system'));

        function addLog(message, type) {
            const output = document.getElementById('consoleOutput');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}-log ${logSettings[type] ? '' : 'hidden-log'}`;
            logEntry.textContent = `[${type.toUpperCase()}] ${message}`;
            output.appendChild(logEntry);
            output.scrollTop = output.scrollHeight;
        }

        function jsonLog(msg) { addLog(msg, 'json'); }
        function systemLog(msg) { addLog(msg, 'system'); }
        function errorLog(msg) { addLog(msg, 'error'); }

        function executeCommand() {
            const input = document.getElementById('cmdInput').value;
            jsonLog('Received command: ' + input);
            try {
                const cmd = JSON.parse(input);
                if (cmd.path && (cmd.data !== undefined)) {
                    jsonLog(`Attempting to write to ${cmd.path}`);
                    firebase.database().ref(cmd.path).set(cmd.data).then(() => {
                        jsonLog('Database updated successfully at ' + cmd.path);
                    }).catch(err => {
                        errorLog('Database write error: ' + err);
                    });
                } else {
                    errorLog('Invalid command structure. JSON requires both path and data.');
                }
            } catch (e) {
                errorLog('JSON parse error: ' + e);
            }
            document.getElementById('cmdInput').value = '';
        }

        function toggleLog(type) {
            if (!logSettings[type]) systemLog(`${type.toUpperCase()} logging was off, re-enabling.`);
            else systemLog(`${type.toUpperCase()} logging now hiding entries.`);

            logSettings[type] = !logSettings[type];
            const button = document.getElementById(`${type}LogBtn`);
            button.className = logSettings[type] ? 'btn-on' : 'btn-off';

            document.querySelectorAll(`.${type}-log`).forEach(entry => {
                if (logSettings[type]) {
                    entry.classList.remove('hidden-log');
                } else {
                    entry.classList.add('hidden-log');
                }
            });
        }

        // Load Database View - retrieves and evals soft-coded functions from database
        function loadDatabaseView() {
            systemLog('Loading Database View...');
            firebase.database().ref('/views/databaseViewScript').once('value').then(snapshot => {
                const script = snapshot.val();
                if (script) {
                    systemLog('Database View script loaded from database. Executing...');
                    eval(script);
                } else {
                    errorLog('No database view script found in database.');
                }
            }).catch(err => {
                errorLog('Error loading database view script: ' + err);
            });
        }

        document.getElementById('cmdInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') executeCommand();
        });
    </script>
</body>
</html>

